<Window x:Class="ParameterExtractor.Wpf.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:ParameterExtractor.Wpf.ViewModels"
        xmlns:converters="clr-namespace:ParameterExtractor.Wpf.Converters"
        mc:Ignorable="d"
        Title="ParameterExtractor - X-ray Detector Configuration Tool"
        Width="1000"
        Height="700"
        MinWidth="800"
        MinHeight="600"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <vm:MainWindowViewModel />
    </Window.DataContext>

    <Window.Resources>
        <converters:ValidationStatusConverter x:Key="ValidationStatusConverter" />
        <converters:ValidationStatusTextConverter x:Key="ValidationStatusTextConverter" />
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="ParameterExtractor" FontSize="24" FontWeight="SemiBold" Foreground="#333333" />
            <TextBlock Text="Extract and validate X-ray detector panel parameters from PDF datasheets"
                       FontSize="14" Foreground="#666666" />
        </StackPanel>

        <!-- Toolbar -->
        <ToolBar Grid.Row="1" ToolBarTray.IsLocked="True">
            <Button Command="{Binding LoadPdfCommand}" Content="Load PDF" Padding="12,6" Margin="0,0,8,0" Style="{StaticResource PrimaryButton}" />
            <Button Command="{Binding ValidateAllCommand}" Content="Validate All" Padding="12,6" Margin="0,0,8,0" />
            <Button Command="{Binding AddParameterCommand}" Content="Add Parameter" Padding="12,6" Margin="0,0,8,0" />
            <Button Command="{Binding RemoveParameterCommand}" Content="Remove Selected" Padding="12,6" Margin="0,0,8,0" />
            <Separator />
            <Button Command="{Binding ExportCommand}" Content="Export YAML" Padding="12,6" Style="{StaticResource PrimaryButton}" />
        </ToolBar>

        <!-- Source file info -->
        <Border Grid.Row="1" Background="#F0F0F0" Padding="8" Margin="0,8,0,0" HorizontalAlignment="Left"
                Visibility="{Binding SourceFilePath, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock>
                <Run Text="Source: " FontWeight="SemiBold" />
                <Run Text="{Binding SourceFilePath}" />
            </TextBlock>
        </Border>

        <!-- Main DataGrid -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding Parameters}"
                  SelectedItem="{Binding SelectedParameter}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Single"
                  GridLinesVisibility="Horizontal">

            <DataGrid.Columns>
                <DataGridTextColumn Header="Name" Binding="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Width="200" />
                <DataGridTextColumn Header="Value" Binding="{Binding Value, UpdateSourceTrigger=PropertyChanged}" Width="120" />
                <DataGridTextColumn Header="Unit" Binding="{Binding Unit, UpdateSourceTrigger=PropertyChanged}" Width="80" />
                <DataGridTextColumn Header="Category" Binding="{Binding Category, UpdateSourceTrigger=PropertyChanged}" Width="180" />
                <DataGridTextColumn Header="Status" Binding="{Binding ValidationStatus, Converter={StaticResource ValidationStatusTextConverter}}" Width="80" IsReadOnly="True" />
                <DataGridTextColumn Header="Message" Binding="{Binding ValidationMessage}" Width="*" IsReadOnly="True" />
            </DataGrid.Columns>

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Background" Value="{Binding ValidationStatus, Converter={StaticResource ValidationStatusConverter}}" />
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#0078D4" />
                            <Setter Property="Foreground" Value="White" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>

        <!-- Validation Summary -->
        <ItemsControl Grid.Row="3" Margin="0,16,0,0" ItemsSource="{Binding ValidationSummary}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Background="{Binding Status, Converter={StaticResource ValidationStatusConverter}}"
                            Padding="12,6"
                            Margin="0,0,8,0"
                            CornerRadius="4"
                            MinWidth="100">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Label}" FontWeight="SemiBold" />
                            <TextBlock Text=": " Margin="4,0,0,0" />
                            <TextBlock Text="{Binding Count}" FontWeight="Bold" />
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="4">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar Width="100" Height="16" IsIndeterminate="{Binding IsBusy}"
                             Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>

</Window>
