<Window x:Class="XrayDetector.Gui.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:XrayDetector.Gui.ViewModels"
        mc:Ignorable="d"
        Title="X-ray Detector Panel System"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        WindowStartupLocation="CenterScreen">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#F0F0F0">
            <MenuItem Header="_File">
                <MenuItem Header="_Open Config..." Command="{Binding OpenConfigCommand}"/>
                <MenuItem Header="_Save Frame..." Command="{Binding SaveFrameCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit"/>
            </MenuItem>
            <MenuItem Header="_Connection">
                <MenuItem Header="_Connect" Command="{Binding ConnectCommand}"/>
                <MenuItem Header="_Disconnect" Command="{Binding DisconnectCommand}"/>
            </MenuItem>
            <MenuItem Header="_Acquisition">
                <MenuItem Header="_Start" Command="{Binding StartAcquisitionCommand}"/>
                <MenuItem Header="S_top" Command="{Binding StopAcquisitionCommand}"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Status Bar" IsCheckable="True" IsChecked="True"/>
                <MenuItem Header="_Full Screen"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About"/>
            </MenuItem>
        </Menu>

        <!-- Main Content: Tabbed Interface per REQ-TOOLS-040 -->
        <TabControl Grid.Row="1" Margin="8">

            <!-- Tab 1: Status Dashboard (REQ-TOOLS-045) -->
            <TabItem Header="Status Dashboard">
                <ScrollViewer>
                    <StackPanel Margin="16">
                        <TextBlock Text="System Status" FontSize="24" FontWeight="Bold" Margin="0,0,0,16"/>

                        <!-- Connection Status -->
                        <GroupBox Header="Connection" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="State:" Margin="8"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding StatusViewModel.ConnectionState}" Margin="8" FontWeight="Bold"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Host:" Margin="8"/>
                                <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="8">
                                    <TextBox Text="{Binding HostAddress, UpdateSourceTrigger=PropertyChanged}" Width="150"/>
                                    <TextBlock Text=":" Margin="4,0"/>
                                    <TextBox Text="{Binding Port, UpdateSourceTrigger=PropertyChanged}" Width="60"/>
                                </StackPanel>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Throughput:" Margin="8"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding StatusViewModel.ThroughputGbps, StringFormat={}{0:F2} Gbps}" Margin="8"/>
                            </Grid>
                        </GroupBox>

                        <!-- Acquisition Status -->
                        <GroupBox Header="Acquisition" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="State:" Margin="8"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding StatusViewModel.AcquisitionState}" Margin="8" FontWeight="Bold"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Frames Received:" Margin="8"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FramesReceived}" Margin="8"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Dropped Frames:" Margin="8"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding DroppedFrames}" Margin="8" Foreground="Red"/>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Tab 2: Frame Preview (REQ-TOOLS-041, REQ-TOOLS-042) -->
            <TabItem Header="Frame Preview">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Window/Level Controls -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="8" Background="#F5F5F5">
                        <TextBlock Text="Window Center:" VerticalAlignment="Center" Margin="8,0"/>
                        <Slider Width="150" VerticalAlignment="Center" Minimum="0" Maximum="65535"
                                Value="{Binding WindowCenter}" TickFrequency="1000" IsSnapToTickEnabled="True"/>
                        <TextBox Text="{Binding WindowCenter, StringFormat={}{0:F0}}" Width="80" Margin="8,0"/>

                        <TextBlock Text="Window Width:" VerticalAlignment="Center" Margin="16,0,0,0"/>
                        <Slider Width="150" VerticalAlignment="Center" Minimum="1" Maximum="65535"
                                Value="{Binding WindowWidth}" TickFrequency="1000" IsSnapToTickEnabled="True"/>
                        <TextBox Text="{Binding WindowWidth, StringFormat={}{0:F0}}" Width="80" Margin="8,0"/>

                        <Button Content="Auto" Command="{Binding AutoWindowLevelCommand}" Margin="16,0,8,0" Padding="16,4"/>
                    </StackPanel>

                    <!-- Frame Display -->
                    <Border Grid.Row="1" BorderBrush="DarkGray" BorderThickness="1" Margin="8" Background="Black">
                        <Image x:Name="FrameImage"
                               Stretch="Uniform"
                               RenderOptions.BitmapScalingMode="NearestNeighbor"
                               RenderOptions.EdgeMode="Aliased"/>
                    </Border>

                    <!-- Frame Info -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="8">
                        <TextBlock Text="{Binding FramePreviewViewModel.FrameInfo}" FontWeight="Bold"/>
                        <TextBlock Text=" | " Margin="8,0"/>
                        <TextBlock Text="{Binding FramePreviewViewModel.MinValue, StringFormat={}Min: {0}}"/>
                        <TextBlock Text=" | " Margin="8,0"/>
                        <TextBlock Text="{Binding FramePreviewViewModel.MaxValue, StringFormat={}Max: {0}}"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Tab 3: Configuration -->
            <TabItem Header="Configuration">
                <ScrollViewer>
                    <StackPanel Margin="16">
                        <TextBlock Text="Detector Configuration" FontSize="24" FontWeight="Bold" Margin="0,0,0,16"/>

                        <GroupBox Header="Panel Parameters" Margin="0,0,0,16">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Width (pixels):" Margin="8"/>
                                <TextBox Grid.Row="0" Grid.Column="1" Text="2048" Margin="8" IsReadOnly="True"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Height (pixels):" Margin="8"/>
                                <TextBox Grid.Row="1" Grid.Column="1" Text="2048" Margin="8" IsReadOnly="True"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Bit Depth:" Margin="8"/>
                                <TextBox Grid.Row="2" Grid.Column="1" Text="16" Margin="8" IsReadOnly="True"/>
                            </Grid>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

        </TabControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="v1.0.0"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
